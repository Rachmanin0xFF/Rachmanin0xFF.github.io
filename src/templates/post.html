{% extends "base.html" %}

{% block header %}
<header>
  <h1><a href="../../">Adam Lastowka</a></h1>
</header>
{% endblock %}

{% block favicon_and_stylesheet %}
<link rel="icon" href="../../favicon.ico" type="image/x-icon">
<link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="../../style.css">
<link rel="stylesheet" href="../../lightfair.css">
<script src="../../highlight.min.js"></script>
{% endblock %}

{% block nav_links %}
<a href="../../">Home</a>
<a href="../../about/">About</a>
<a href="../../qa/">Q&A</a>
{% endblock %}

{% block extra_head %}
<script>
  window.MathJax = {
    tex: {
      inlineMath: [
        ['$', '$'],
        ["\\(", "\\)"]
      ],
      displayMath: [
        ['$$', '$$'],
        ["\\[", "\\]"]
      ],
      processEscapes: true,
    },
    chtml: {
      scale: 1,
      displayAlign: 'center'
    }
  };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>

{% if plotly %}
<script async defer src="https://cdn.plot.ly/plotly-latest.min.js"></script>{% endif %}
{% endblock %}

{% block content %}
<h1>{{ title }}</h1>
<time>{{ date }}</time>
<div class="post-body">
  {{ html }}
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  if (window.hljs) {
    hljs.highlightAll();
  }

  // Add footnote tooltips
  document.querySelectorAll('.footnote-ref').forEach(ref => {
    const fnId = ref.getAttribute('href');
    if (fnId) {
      // Escape the ID selector (colons need to be escaped in querySelector)
      const escapedId = fnId.replace(/:/g, '\\:');
      const fnElement = document.querySelector(escapedId);
      if (fnElement) {
        let html = fnElement.innerHTML
          .replace(/<a class="footnote-backref".*?<\/a>/s, '') // Remove the backref link
          .trim();

        // Remove <p> tags if the content is wrapped in them
        html = html.replace(/^<p>(.*)<\/p>$/s, '$1');

        const tooltip = document.createElement('div');
        tooltip.className = 'footnote-tooltip';
        tooltip.innerHTML = html;

        let hideTimeout;

        const showTooltip = () => {
          clearTimeout(hideTimeout);
          tooltip.classList.add('visible');
        };

        const hideTooltip = () => {
          hideTimeout = setTimeout(() => {
            tooltip.classList.remove('visible');
          }, 100); // Small delay to allow moving to tooltip
        };

        ref.addEventListener('mouseenter', showTooltip);
        ref.addEventListener('mouseleave', hideTooltip);
        tooltip.addEventListener('mouseenter', showTooltip);
        tooltip.addEventListener('mouseleave', hideTooltip);

        ref.appendChild(tooltip);
      }
    }
  });
</script>
{% endblock %}